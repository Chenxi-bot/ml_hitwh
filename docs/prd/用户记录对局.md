用户记录对局
======

- [ ] 用户新建对局
    - return 对局编号
- [ ] 用户记录最终分数到对局
    - 通过回复消息指定对局
    - 通过编号指定对局
    - 用户代他人记录
- [ ] 支持撤销结算
- [ ] 支持删除对局、超过一段时间未完成自动删除

## 对局状态机

- 未完成（初始）：未完成、异常、已完成
- 异常：未完成、已完成
- 已完成：

## 对局消息链

当用户引用bot发送的，与对局相关的消息时，可以视作提供了对局上下文。程序应维护与（未完成或异常状态的）对局相关的消息ID的集合，对局流转到已完成/删除状态后清空该集合。

## 指令设计

### 用户新建对局

指令：`新建对局`

结果：

新建对局，对局状态为未完成

```
成功新建对局xxxxx，对此消息回复“结算 <分数>”指令记录你的分数
```

### 用户记录最终分数到对局

指令：
- 引用消息方式：`[引用消息]结算 <分数>`
- 指定编号方式：`结算 对局<编号> <分数>`
- 引用消息方式代他人记录：`[引用消息]结算 @<用户> <分数>`
- 指定编号方式代他人记录：`结算 对局<编号> @<用户> <分数>`

响应：

[1] 结算人数少于4人，对局保持未完成状态

```
成功记录到对局xxxxx，当前记录情况：

name    50000
name    32000
```

[2] 结算人数等于4人，分数之和等于100000，对局流转到已完成状态

```
成功记录到对局xxxxx，对局已成功结算：

#1 name    50000
#2 name    32000
#3 name    12000
#4 name     6000
```

[3] 结算人数等于4人，分数之和不等于100000，对局流转到异常状态

```
成功记录到对局xxxxx，当前记录情况：

#1 name    50000
#2 name    32000
#3 name    12000
#4 name     2000

警告：分数之和不等于100000，对此消息回复"撤销结算"指令撤销你的分数后重新记录
```

### 记录撤销

指令：

- 引用消息方式：`[引用消息]撤销结算`
- 指定编号方式：`撤销结算 对局<编号>`
- 引用消息方式代他人记录：`[引用消息]撤销结算 @<用户>`
- 指定编号方式代他人记录：`撤销结算 对局<编号> @<用户>`

响应：

```
成功撤销记录到对局xxxxx，当前记录情况：

name    50000
name    32000
```

备注：

引用“代他人记录分数”的消息时，可以认为是代他人撤销。

### 删除对局

指令：

- 引用消息方式：`[引用消息]删除对局`
- 指定编号方式：`删除对局 对局<编号>`

响应：

```
成功删除对局xxxxx
```
