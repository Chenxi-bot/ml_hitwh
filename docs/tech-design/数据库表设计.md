# 数据库表设计

数据库选用PostgreSQL

## 对局相关

### Game

| 字段              | 数据类型          | 可空       | 约束  |
|-----------------|---------------|----------|-----|
| id              | serial        |          | 主键  |
| code            | int           | NOT NULL ||
| group_id        | bigint        | NOT NULL ||
| create_user_id  | bigint        |||
| season_id       | int           |||
| player_and_wind | playerandwind | NOT NULL ||
| state           | gamestate     | NOT NULL ||
| create_time     | timestamp     | NOT NULL ||
| delete_time     | timestamp     |||

```python
class PlayerAndWind(enum.Enum):
    FOUR_MEN_EAST = 1
    FOUR_MEN_SOUTH = 2
    THREE_MEN_EAST = 3
    THREE_MEN_SOUTH = 4


class GameState(enum.Enum):
    uncompleted = 1
    completed = 2
    invalid_total_point = 3
```

### GameRecord

| 字段      | 数据类型   | 可空       | 约束  |
|---------|--------|----------|-----|
| id      | serial |          | 主键  |
| game_id | int    | NOT NULL ||
| user_id | bigint | NOT NULL ||
| score   | int    | NOT NULL ||
| point   | int    |||

## 赛季相关

### Season

| 字段          | 数据类型        | 可空       | 约束  |
|-------------|-------------|----------|-----|
| id          | serial      |          | 主键  |
| group_id    | bigint      | NOT NULL ||
| state       | seasonstate | NOT NULL ||
| name        | varchar     |          ||
| code        | int         |          ||
| start_time  | timestamp   ||
| end_time    | timestamp   |
| create_time | timestamp   | NOT NULL |
| delete_time | timestamp   |

```python
class SeasonState(enum.Enum):
    initial = 0
    running = 1
    finished = 2
```

### UserSeasonPoint

| 字段                 | 数据类型   | 可空       | 约束  |
|--------------------|--------|----------|-----|
| user_id            | bigint | NOT NULL | 主键  |
| season_id          | int    | NOT NULL | 主键  |
| point              | int    | NOT NULL |
| last_change_log_id | int    |

### UserSeasonPointChangeLog

| 字段                 | 数据类型                      | 可空       | 约束  | 含义                                                              |
|--------------------|---------------------------|----------|-----|-----------------------------------------------------------------|
| id                 | serial                    | NOT NULL | 主键  |                                                                 |
| user_id            | bigint                    | NOT NULL |     |                                                                 |
| season_id          | int                       | NOT NULL |     |                                                                 |
| change_type        | userseasonpointchangetype | NOT NULL |
| change_point       | int                       | NOT NULL |     | 若change_type=BY_GAME，这列是PT增减相对值；若change_type=MANUALLY，这列是设置的PT值 |
| related_game_id    | int                       |
| prev_change_log_id | int                       |

```python
class UserSeasonPointChangeType(enum.Enum):
    BY_GAME = 0
    MANUALLY = 1
```

## 用户&群信息相关

### Userinfo

| 字段                 | 数据类型    | 可空       | 约束  |
|--------------------|---------|----------|-----|
| user_id            | bigint  | NOT NULL | 主键  |
| group_id           | bigint  | NOT NULL | 主键  |
| nickname           | varchar |

### Groupinfo

| 字段                | 数据类型   | 可空       | 约束  |
|-------------------|--------|----------|-----|
| group_id          | bigint | NOT NULL | 主键  |
| running_season_id | int    | 
